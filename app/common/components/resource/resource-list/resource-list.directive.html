<!-- Resource Filters -->
<div class="row" ng-class="{'hidden-xs': subResource.resource}">
  <resource-search class="col-md-10 col-xs-offset-0 col-md-offset-1 show subview-12 subview-offset-0"
                   settings="config.search.params"
                   on-params-changed="onSearchParamsChanged(params)"
                   default-params="config.search.defaultParams"
  ></resource-search>
</div>



<!-- Listing -->
<div class="row">
  <div
    ng-class="'col-xs-2 col-sm-4 col-lg-5'"
    class="fill-height-bar"
  >
    <div infinite-scroll="getMore()" infinite-scroll-distance='0.8' infinite-scroll-use-document-bottom="false"
         infinite-scroll-parent infinite-scroll-disabled="getMoreIsBusy || !morePagesAvailable"
         infinite-scroll-listen-for-event="list:filtered"
    >
      <table id="resource-list-table" class="table table-striped table-hover">
        <thead>
          <tr>
            <!--
              TODO select all
            <th ng-class="{'hidden-xs': subResource.resource}">

              <input type="checkbox"
                     class="resource-list-checkbox"
                     ng-click="toggleSelectAll(selector.checked)"
                     ng-model="selector.checked">


            </th>
            -->
            <th ng-repeat="th in config.table.th"
                field-sort sort="setSort(sort)" key="{{::th.key}}" name="{{::th.name}}" group="sort"
                sort-by-default="th.default"
            ></th>
            <th></th>
          </tr>
        </thead>
        <tbody>
          <tr ng-repeat="resource in resources track by resource._id"
              ng-class="{info: selector.checkboxes[resource['_id']]}"

              ng-init="popover = popovers[resource._id]"

              uib-popover-template="::popovers.templateUrl"
              popover-enable="popovers.enable"
              popover-title="{{::popover.title}}"
              popover-is-open="popover.isOpen"
              popover-trigger="click"
              popover-append-to-body="true"
              popover-placement="{{popoverPlacement}}"
              popover-class="resource-button-popover"

              ng-click="$evalAsync(toggleSelect(resource, $event, $index))"
              >
            <!--ng-dblclick="subResource.openFull(resource)"-->

          <!--<td ng-class="{'hidden-xs': subResource.resource}">
            <input class="resource-list-checkbox"
                   type="checkbox"
                   ng-click=""
                   ng-model="selector.checkboxes[resource['_id']]"
                   ng-class="{blink: hoverScreener && resource._id === resources[0]._id && inList.length == 0}"
            >
          </td>-->
            <!-- $evalasync from https://stackoverflow.com/a/31352712 -->
            <td ng-repeat="td in ::config.table.td"
                ng-init="value = $root._.get(resource, td.value)"
            >
              <div ng-if="::td.templateUrl" ng-include="td.templateUrl"></div>
              <div ng-if="::value && !$root._.isDate(value)">
                <!-- We cannot use the value from ng-init if we want it to be updateable -->
                <span ng-if="::td.humanize">
                  {{::$root._.get(resource, td.value) | humanize}}
                </span>
                <span ng-if="::td.number">
                  {{::$root._.get(resource, td.value) | number}}
                </span>
                <!-- For now only label can be changed from a resource without refreshing the list, and label field
                falls in here -->
                <span ng-if="::!td.humanize && !td.number">
                  <!-- Let's show more characters if we have a lg screen -->
                  <span class="hidden-lg">
                    {{$root._.get(resource, td.value) | limitTo: (td.limitTo || 15)}}
                    <small ng-show="$root._.get(resource, td.value).length > (td.limitTo || 15)">&hellip;</small>
                  </span>
                  <span class="hidden-xs hidden-sm hidden-md">
                    {{$root._.get(resource, td.value) | limitTo: (td.limitTo || 15) + 7}}
                    <small ng-show="$root._.get(resource, td.value).length > (td.limitTo || 15) + 7">&hellip;</small>
                  </span>
                </span>
              </div>
              <div ng-if="::value && $root._.isDate(value)">{{value | timeAgo}}</div>
            </td>
            <td ng-click="$evalAsync(subResource.toggle(resource))"
                ng-dblclick="subResource.openFull(resource)"
                class="text-center"
            >
              <resource-icon resource-type="{{::resource['@type']}}"
                             resource-subtype="{{::resource.type}}"
              >
              </resource-icon>
            </td>
          </tr>
        </tbody>
      </table>
      <div class="text-center">
        <i
          ng-class="{
                      'fa fa-circle-o-notch fa-spin fa-lg': getMoreIsBusy && morePagesAvailable,
                      'fa fa-ellipsis-h fa-lg': !morePagesAvailable
                    }
                   "
        ></i>
      </div>
    </div>
  </div>
  <!-- SubResource in right-bar -->
  <aside class="col-xs-10 col-sm-8 col-lg-7" id="aside-subResource">
    <div>
      Display lot resume or device information
    </div>
    <div ng-if="selector.inList.length == 0">
      Lot info
    </div>
    <div ng-if="selector.inList.length > 0">
      Device info
    </div>
    <!--<h1>{{resource.summary.numberDevices}}</h1>-->
    <!-- Butttons -->
    <div id="buttons" class="row text-center" ng-class="{'hidden-xs': subResource.resource}">
      <div id="screener"
           uib-tooltip="Select some {{resourceName}} first."
           tooltip-enable="selector.inList.length == 0"
           ng-mouseenter="hoverScreener = true"
           ng-mouseleave="hoverScreener = false"
      >
        <div ng-show="selector.inList.length == 0"></div>
        <div ng-include="config.buttons.templateUrl + (session.hasExplicitPerms()? '' : '-shared') + '.html'"></div>
      </div>
    </div>
    <!-- <resource-view resource="subResource.resource" type="medium"></resource-view> -->
  </aside>
</div>

