<resource-search settings="paramsSettings"
                 on-params-changed="onParamsChanged(params)"
                 default-params="DEFAULT_SEARCH_PARAMS"
></resource-search>
<div>
  <div style="text-align: center"
       id="selectedMenu"
       class="ani-show"
  >
    <div id="screener"
         uib-tooltip="Select some devices first."
         tooltip-enable="selectedDevices.length == 0"
         ng-mouseenter="hoverScreener = true"
         ng-mouseleave="hoverScreener = false"
    >
      <div ng-show="selectedDevices.length == 0"></div>
      <device-label-button
        devices="selectedDevices"
      ></device-label-button>
      <manual-events-button devices="selectedDevices"></manual-events-button>
      <share devices="selectedDevices"></share>
      <certificate-button devices="selectedDevices"></certificate-button>
    </div>
  </div>
  <div class="row">
    <div ng-class="{'col-xs-12': _.isEmpty(viewingDevice), 'col-xs-5 col-lg-6': !_.isEmpty(viewingDevice)}"
         class="fill-height" id="device-list">
      <div>
        <table id="device-list-table" class="table table-striped table-hover">
          <thead>
            <tr>
              <th><resource-list-select-all></resource-list-select-all></th>
              <th field-sort sort="setSort(sort)" key="_id" name="Id" group="sort"></th>
              <th field-sort sort="setSort(sort)" key="label" name="Label" group="sort"></th>
              <th field-sort sort="setSort(sort)" key="model" name="Model" group="sort"></th>
              <th field-sort sort="setSort(sort)" key="events._updated" name="Last event" group="sort"
                  sort-by-default="true"></th>
              <th field-sort sort="setSort(sort)" key="_created" name="Registered in" group="sort"></th>
              <th>Serial number</th>
              <th></th>
            </tr>
          </thead>
          <tbody>
            <tr ng-repeat="device in devices"
                ng-click="toggleDeviceView(device)"
                ng-class="{info: isSelected(device._id)}"
                class="ani-default"
            >
              <td>
                <input class="device-list-checkbox"
                       type="checkbox"
                       checklist-model="selectedDevices"
                       checklist-value="device"
                       ng-click="$event.stopPropagation(); select_multiple($event, devices, $index);  broadcastSelection()"
                       ng-class="{blink: hoverScreener && device._id === devices[0]._id && selectedDevices.length == 0}"
                >
              </td>
              <td>{{device._id}}</td>
              <td>{{device.labelId}}</td>
              <td>{{device.model}}</td>
              <td>
                <resource-button ng-if="device.events"
                                 resource="device.events[0]"
                                 ng-click="$event.stopPropagation()"
                ></resource-button>
              </td>
              <td>{{device._created | timeAgo}}</td>
              <td>{{device.serialNumber | limitTo : 10}}{{device.serialNumber.length > 10? '&hellip;': ''}}</td>
              <td>
                <device-icon type="{{device['@type']}}" subtype="{{device.type}}"></device-icon>
              </td>
            </tr>
          </tbody>
        </table>
        <div class="text-center" ng-show="!busy && moreData">
          <button class="btn btn-default" ng-click="getDevices(false,true)">Load more</button>
        </div>
      </div>
    </div>
    <device
      api="deviceApi"
      class="col-xs-7 col-lg-6 ani-show-no-hide"
      ng-hide="_.isEmpty(viewingDevice)"
    ></device>
  </div>
</div>
