<!-- Resource Search -->
<div class="row">
  <resource-search settings="config.search.params"
                   on-params-changed="onSearchParamsChanged(params)"
                   default-params="config.search.defaultParams"
  ></resource-search>
</div>

<!-- Butttons -->
<div id="buttons" class="row text-center">
  <div id="screener"
       uib-tooltip="Select some {{resourceName}} first."
       tooltip-enable="selector.inList.length == 0"
       ng-mouseenter="hoverScreener = true"
       ng-mouseleave="hoverScreener = false"
  >
    <div ng-show="selector.inList.length == 0"></div>
    <div ng-include="config.buttons.templateUrl"></div>
  </div>
</div>

<!-- Listing -->
<div class="row">
  <div
    ng-class="{
      'col-xs-12': type !== 'big' || !subResource.resource,
      'col-xs-5 col-lg-6': type === 'big' && subResource.resource
    }"
    class="fill-height-bar"
  >
    <table id="resource-list-table" class="table table-striped table-hover">
      <thead>
        <tr>
          <th>
            <input type="checkbox"
                   class="resource-list-checkbox"
                   ng-click="toggleSelectAll(selector.checked)"
                   ng-model="selector.checked">

          </th>
          <th ng-repeat="th in config.table.th"
              field-sort sort="setSort(sort)" key="{{::th.key}}" name="{{::th.name}}" group="sort"
          ></th>
          <th field-sort sort="setSort(sort)" key="_created" name="Registered in" group="sort"></th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        <tr ng-repeat="resource in resources"
            ng-class="{info: subResource.isOpened(resource._id)}"

            ng-init="popover=popovers[resource._id]"

            uib-popover-template="popovers.templateUrl"
            popover-enable="popovers.enable"
            popover-title="{{popover.title}}"
            popover-is-open="popover.isOpen"
            popover-trigger="click"
            popover-append-to-body="true"
            popover-placement="auto left"
            popover-class="resource-button-popover"
        >
          <td>
            <input class="resource-list-checkbox"
                   type="checkbox"
                   ng-click="toggleSelect(resource, $event, $index)"
                   ng-model="selector.checkboxes[resource['_id']]"
                   ng-class="{blink: hoverScreener && resource._id === resources[0]._id && inList.length == 0}"
            >
          </td>
          <td ng-repeat="td in config.table.td" ng-click="subResource.toggle(resource)">
            <div ng-if="td.templateUrl" ng-include="td.templateUrl"></div>
            <div ng-if="td.value">
              {{resource[td.value] | limitTo: 19}}
              <small>
                {{resource[td.value].length > 19? '&hellip;':''}}
              </small>
            </div>
          </td>
          <td ng-click="subResource.toggle(resource)">{{resource._created | timeAgo}}</td>
          <td ng-click="subResource.toggle(resource)">
            <resource-icon resource-type="{{resource['@type']}}" resource-subtype="{{resource.type}}"></resource-icon>
          </td>
        </tr>
      </tbody>
    </table>
    <div class="text-center" ng-show="!loadMoreIsBusy && pagination.morePagesAvailable">
      <button class="btn btn-primary btn-sm" ng-click="loadMore()">
        Load more&nbsp;<i class="fa fa-plus"></i>
      </button>
    </div>
  </div>
  <!-- SubResource in right-bar -->
  <aside ng-if="type === 'big' && subResource.resource" class="col-xs-7 col-lg-6">
    <resource-view resource="subResource.resource" type="medium"></resource-view>
  </aside>
</div>

